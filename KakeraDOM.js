/**
 * @license
 * Copyright (C) CABSOFTWARE.COM - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Seungchul Kang <ksc214@gmail.com>, November 2015
 * @version 1.1.2
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.KakeraDOM=t()}(this,function(){function e(t,n){var i=n[t[0]];return t.length>1&&"undefined"!=typeof i?e(t.slice(1,t.length),i):i}function t(e,t,n){var i;for(i in t)i==n&&"classAlias"==i||(e[i]=t[i]);return e}function n(e,t,n){document.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function i(e,t,n){document.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}function s(e,t,i){var s,r,l,o,a,u,h=function(e,n){return function(i){t[e].call(n,i)}};for(r in t)if(u=r.split(" "),l=u.splice(0,1)[0],o=u.join(" "),"string"==typeof l&&"string"==typeof o)for(a=e.querySelectorAll(o),s=0;s<a.length;s++){var c=h(r,i);n(a.item(s),l,c)}}function r(){}var l=Date.now||function(){return(new Date).getTime()};!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;r.subClass=function(n){function i(){!e&&this._init&&this._init.apply(this,arguments)}var s=this.prototype;e=!0;var r=new this;e=!1;for(var l in n)r[l]="function"==typeof n[l]&&"function"==typeof s[l]&&t.test(n[l])?function(e,t){return function(){var n=this._super;this._super=s[e];var i=t.apply(this,arguments);return this._super=n,i}}(l,n[l]):n[l];return i.prototype=r,i.constructor=i,i.subClass=this.subClass,n.classAlias&&(i.classAlias=n.classAlias),i}}();var o=r.subClass({_children:null,_debounceWait:100,deps:null,template:null,el:null,mixins:null,onWindowResize:null,init:function(){},render:function(){if(null===this.template)throw new Error("["+this.classAlias+"] 클래스의 template이 null 입니다. template을 설정하거나 render를 구현하셔야 합니다.");return"string"==typeof this.template?this.template:this.template.length>1?this.template[0]:void 0},makeEl:function(){var i,r,l,u,h,c,f,d=document.createElement("div"),p={};f={"this":this};for(var v in o.prototype)delete f[v];if(i=this.render(),"object"==typeof i&&(t(f,i.param),i=i.template),i=i.replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">"),this.deps){var m,v,y,g,_=/[\w]+/g;for(u=0;u<this.deps.length;u++){r=this.deps[u],"undefined"==typeof p[r.classAlias]&&(p[r.classAlias]=[]);var w=i.match(new RegExp("<\\s*"+r.classAlias+"(?:\\/>|\\s+(?:.|\\s)*?\\/>)","g"));if(null!==w){var b=new RegExp("{\\.\\.\\..+?}|(\\w*=([\"|']*).+?\\2|{.+})(?=\\s|(?=>)|(?=\\/>))","g");for(h=0;h<w.length;h++){var A=w[h].match(b),z=p[r.classAlias][h]={};if(null!==A){for(c=0;c<A.length;c++){var C=A[c];if(0===C.indexOf("{...")){v=C.substring(4,C.length-1),y=v.match(_).map(function(e){var t=parseInt(e);return isNaN(t)?e:t}),g=e(y,f);for(var E in g)g[E]="function"==typeof g[E]?g[E].bind(this):g[E];t(z,g)}else-1!=C.indexOf("=")&&(m=C.split("="),v=m[0],g=m[1],"{"==g.charAt(0)?(y=g.substring(1,g.length-1).match(_).map(function(e){var t=parseInt(e);return isNaN(t)?e:t}),g=e(y,f),g="function"==typeof g?g.bind(this):g,z[v]=g):"'"==g.charAt(0)||'"'==g.charAt(0)?z[v]=g.substring(1,g.length-1):"true"===g?z[v]=!0:"false"===g?z[v]=!1:z[v]=g)}i=i.replace(w[h],"<div vdom='"+r.classAlias+"'></div>")}else i=i.replace(w[h],"<div vdom='"+r.classAlias+"'></div>")}}}}if(i=i.replace(/<[^\/].+?>/g,function(e){return e.replace(/={.+?}(?=(\s|>))/g,function(e){return"='"+e.substring(1,e.length)+"'"})}),d.innerHTML=a.format(i,f),1!=d.childNodes.length)throw new Error("["+this.classAlias+"] 클래스는 하나의 엘레멘트로 작성되어야 합니다.");return this.el=d.firstChild,s(d,this.listener,this),i=null,f=null,d=null,window&&"function"==typeof this.onWindowResize&&(this._onWindowResize=function(e){var t=function(t){e.onWindowResize.call(e,t)};return a.debounce(t,e._debounceWait)}(this),n(window,"resize",this._onWindowResize)),this.deps&&setTimeout(function(){for(this._children={},u=0;u<this.deps.length;u++){var e=this.deps[u],t=this.el.querySelectorAll("div[vdom='"+e.classAlias+"']");for(h=0;h<t.length;h++){l=a.useFreeze?Object.freeze(p[e.classAlias][h]):a.deepObjCopy(p[e.classAlias][h]);var n=new e(l);this.addChild(n);var i=n.makeEl();n.willMount(),t.item(h).parentNode.replaceChild(i,t.item(h));var s=function(e){return function(){e.didMount()}}(n);setTimeout(s,a.delay)}e=null}a.useFreeze||(p=null)}.bind(this),a.delay),this.el},willMount:function(){},didMount:function(){},refresh:function(){setTimeout(function(){var e,t=this.el;this.removeAllChild(),this._onWindowResize&&(i(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),e=this.makeEl(),this.willMount(),t.parentNode.replaceChild(e,t),setTimeout(function(){this.didMount()}.bind(this),a.delay)}.bind(this),a.delay)},children:function(e){var t;return null===this._children?null:(t="string"==typeof e?this._children.map[e]:"number"==typeof e?this._children.list[e]:this._children,"undefined"==typeof t?null:t)},addChild:function(e){this._children=this._children||{},this._children.list=this._children.list||[],this._children.list.push(e),this._children.map=this._children.map||{},"undefined"!=typeof this._children.map[e.classAlias]?this._children.map[e.classAlias].push(e):this._children.map[e.classAlias]=[e]},removeChild:function(e){var t,n,i,s;if(null!==this._children){if("number"==typeof e)t=e,i=this._children.list[t];else for(t=0;t<this._children.list.length;t++)if(this._children.list[t]===e){i=this._children.list[t];break}if(i){for(s=this._children.map[i.classAlias],this._children.list.splice(t,1),n=0;n<s.length;n++)s[n]===i&&s.splice(n,1);i.release()}0===this._children.list.length&&(this._children=null)}},removeAllChild:function(){var e,t;if(null!==this._children){if("undefined"!=typeof this._children.list){e=this._children.list.length;for(var n=0;e>n;n++)t=this._children.list[n],t.release()}this._children=null}},release:function(){var e;if(null!==this._children){if(e=this._children.list,null!==e&&"undefined"!=typeof e)for(var t=0;t<e.length;t++)e[t].release();this._children=null}this._onWindowResize&&(i(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),"function"==typeof this.destroy&&this.destroy(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=null,this.props=null,this.args=null},destroy:function(){}}),a={delay:0,useFreeze:"function"==typeof Object.freeze,multiline:function(e){return e.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">")},format:function(){var t=arguments;if(2==arguments.length){if(arguments[1]instanceof Array)return arguments[0].replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[1][n]?t[1][n]:e});if(arguments[1]instanceof Object)return arguments[0].replace(/{[^}]+}/g,function(n,i){var s,r,l,o,a=n.substring(1,n.length-1),u=!1;if(a.length>3&&"..."==a.substring(0,3)&&(u=!0),u){s="",a=a.substring(3),l=a.match(/[\w]+/g).map(function(e){var t=parseInt(e);return isNaN(t)?e:t}),o=e(l,t[1]);for(r in o)s+=r+'="'+o[r]+'" ';return""!==s?s:n}return l=a.match(/[\w]+/g).map(function(e){var t=parseInt(e);return isNaN(t)?e:t}),o=e(l,t[1]),"undefined"!=typeof o?o:n})}return arguments[0].replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[Number(n)+1]?t[Number(n)+1]:e})},extend:function(e,t){var n;for(n in t)e[n]=t[n];return e},deepObjCopy:function(e){var t={};if("object"==typeof e){if("undefined"!=typeof e.length)var t=new Array;for(var n in e){var i=typeof e[n];switch(i){case"object":t[n]=a.deepObjCopy(e[n]);break;case"boolean":1==e[n]?t[n]=!0:t[n]=!1;break;default:t[n]=e[n]}}}return t},debounce:function(e,t,n){var i,s,r,o,a,u=function(){var h=l()-o;t>h&&h>=0?i=setTimeout(u,t-h):(i=null,n||(a=e.apply(r,s),i||(r=s=null)))};return function(){r=this,s=arguments,o=l();var h=n&&!i;return i||(i=setTimeout(u,t)),h&&(a=e.apply(r,s),r=s=null),a}},createClass:function(e,n){var i={_init:function(e){this.props=e,"function"==typeof this.init&&this.init()}},s=n.mixins;if(s)for(var r in s)t(i,s[r]);t(i,n,"mixins"),i.classAlias=e;var l;return l=o.subClass(i),l.classAlias=e,l},render:function(e,t){if("object"!=typeof e)throw new Error("객체 타입["+typeof e+"]이 유효하지 않습니다.");if(null===t)throw new Error("랜더링 타겟 엘레멘트가 존재하지 않습니다.");var n=e.makeEl();e.willMount(),t.appendChild(n),setTimeout(function(){e.didMount()},0)}};return a});