/**
 * @license
 * Copyright (C) CABSOFTWARE.COM - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Seungchul Kang <ksc214@gmail.com>, November 2015
 * @version 1.1.1
 */
!function(e,i){"function"==typeof define&&define.amd?define([],i):e.KakeraDOM=i()}(this,function(){function e(i,n){var t=n[i[0]];return i.length>1&&"undefined"!=typeof t?e(i.slice(1,i.length),t):t}function n(e,i,n){var t;for(t in i)t==n&&"classAlias"==t||(e[t]=i[t]);return e}function t(e,i,n){document.addEventListener?e.addEventListener(i,n,!1):e.attachEvent?e.attachEvent("on"+i,n):e["on"+i]=n}function s(e,i,n){document.removeEventListener?e.removeEventListener(i,n,!1):e.attachEvent?e.detachEvent("on"+i,n):e["on"+i]=null}function l(e,i,n){var s,l,r,o,a,u,c=function(e,n){return function(t){i[e].call(n,t)}};for(l in i)if(u=l.split(" "),r=u.splice(0,1)[0],o=u.join(" "),"string"==typeof r&&"string"==typeof o)for(a=e.querySelectorAll(o),s=0;s<a.length;s++){var h=c(l,n);t(a.item(s),r,h)}}function r(){}var o=Date.now||function(){return(new Date).getTime()};!function(){var e=!1,i=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;r.subClass=function(n){function t(){!e&&this._init&&this._init.apply(this,arguments)}var s=this.prototype;e=!0;var l=new this;e=!1;for(var r in n)l[r]="function"==typeof n[r]&&"function"==typeof s[r]&&i.test(n[r])?function(e,i){return function(){var n=this._super;this._super=s[e];var t=i.apply(this,arguments);return this._super=n,t}}(r,n[r]):n[r];return t.prototype=l,t.constructor=t,t.subClass=this.subClass,n.classAlias&&(t.classAlias=n.classAlias),t}}();var a=r.subClass({_children:null,_debounceWait:100,deps:null,template:null,el:null,mixins:null,onWindowResize:null,init:function(){},render:function(){if(null===this.template)throw new Error("["+this.classAlias+"] 클래스의 template이 null 입니다. template을 설정하거나 render를 구현하셔야 합니다.");return"string"==typeof this.template?this.template:this.template.length>1?this.template[0]:void 0},makeEl:function(){var i,s,r,o,c,h,f,d=document.createElement("div"),p={};f={"this":this};for(var v in a.prototype)delete f[v];if(i=this.render(),"object"==typeof i&&(n(f,i.param),i=i.template),i=i.replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">"),this.deps){var m,v,y,g,_=/[\w]+/g;for(o=0;o<this.deps.length;o++){s=this.deps[o],"undefined"==typeof p[s.classAlias]&&(p[s.classAlias]=[]);var w=i.match(new RegExp("<\\s*"+s.classAlias+"(?:\\/>|\\s+(?:.|\\s)*?\\/>)","g"));if(null!==w){var b=new RegExp("{\\.\\.\\..+?}|(\\w*=([\"|']*).+?\\2|{.+})(?=\\s|(?=>)|(?=\\/>))","g");for(c=0;c<w.length;c++){var A=w[c].match(b);if(p[s.classAlias][c]={},null!==A){for(h=0;h<A.length;h++){var z=A[h];if(0===z.indexOf("{...")){v=z.substring(4,z.length-1),y=v.match(_).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),g=e(y,f);for(var C in g)g[C]="function"==typeof g[C]?g[C].bind(this):g[C];n(p[s.classAlias][c],g)}else-1!=z.indexOf("=")&&(m=z.split("="),v=m[0],g=m[1],"{"==g.charAt(0)?(y=g.substring(1,g.length-1).match(_).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),g=e(y,f),g="function"==typeof g?g.bind(this):g,p[s.classAlias][c][v]=g):"'"==g.charAt(0)||'"'==g.charAt(0)?p[s.classAlias][c][v]=g.substring(1,g.length-1):p[s.classAlias][c][v]=g)}i=i.replace(w[c],"<div vdom='"+s.classAlias+"'></div>")}else i=i.replace(w[c],"<div vdom='"+s.classAlias+"'></div>")}}}}if(i=i.replace(/<[^\/].+?>/g,function(e){return e.replace(/={.+?}(?=(\s|>))/g,function(e){return"='"+e.substring(1,e.length)+"'"})}),d.innerHTML=u.format(i,f),1!=d.childNodes.length)throw new Error("["+this.classAlias+"] 클래스는 하나의 엘레멘트로 작성되어야 합니다.");return this.el=d.firstChild,l(d,this.listener,this),i=null,f=null,d=null,window&&"function"==typeof this.onWindowResize&&(this._onWindowResize=function(e){var i=function(i){e.onWindowResize.call(e,i)};return u.debounce(i,e._debounceWait)}(this),t(window,"resize",this._onWindowResize)),this.deps&&setTimeout(function(){for(this._children={},o=0;o<this.deps.length;o++){var e=this.deps[o],i=this.el.querySelectorAll("div[vdom='"+e.classAlias+"']");for(c=0;c<i.length;c++){r=u.useFreeze?Object.freeze(p[e.classAlias][c]):u.deepObjCopy(p[e.classAlias][c]);var n=new e(r);this.addChild(n);var t=n.makeEl();n.willMount(),i.item(c).parentNode.replaceChild(t,i.item(c));var s=function(e){return function(){e.didMount()}}(n);setTimeout(s,u.delay)}e=null}u.useFreeze||(p=null)}.bind(this),u.delay),this.el},willMount:function(){},didMount:function(){},refresh:function(){setTimeout(function(){var e,i=this.el;this.removeAllChild(),this._onWindowResize&&(s(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),e=this.makeEl(),this.willMount(),i.parentNode.replaceChild(e,i),setTimeout(function(){this.didMount()}.bind(this),u.delay)}.bind(this),u.delay)},children:function(e){var i;return null===this._children?null:(i="string"==typeof e?this._children.map[e]:"number"==typeof e?this._children.list[e]:this._children,"undefined"==typeof i?null:i)},addChild:function(e){this._children=this._children||{},this._children.list=this._children.list||[],this._children.list.push(e),this._children.map=this._children.map||{},"undefined"!=typeof this._children.map[e.classAlias]?this._children.map[e.classAlias].push(e):this._children.map[e.classAlias]=[e]},removeChild:function(e){var n,t,s,l;if(null!==this._children){if("number"==typeof e)n=e,s=this._children.list[n];else for(n=0;n<this._children.list.length;n++)if(this._children.list[n]===e){s=this._children.list[n];break}if(s){for(l=this._children.map[s.classAlias],this._children.list.splice(n,1),t=0;i<l.length;t++)l[t]===s&&l.splice(t,1);s.release()}0===this._children.list.length&&(this._children=null)}},removeAllChild:function(){var e,i;if(null!==this._children){if("undefined"!=typeof this._children.list){e=this._children.list.length;for(var n=0;e>n;n++)i=this._children.list[n],i.release()}this._children=null}},release:function(){var e;if(null!==this._children){if(e=this._children.list,null!==e&&"undefined"!=typeof e)for(var i=0;i<e.length;i++)e[i].release();this._children=null}this._onWindowResize&&(s(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),"function"==typeof this.destroy&&this.destroy(),this.el.parentNode.removeChild(this.el)},destroy:function(){}}),u={delay:0,useFreeze:"function"==typeof Object.freeze,multiline:function(e){return e.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">")},format:function(){var i=arguments;if(2==arguments.length){if(arguments[1]instanceof Array)return arguments[0].replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof i[1][n]?i[1][n]:e});if(arguments[1]instanceof Object)return arguments[0].replace(/{[^}]+}/g,function(n,t){var s,l,r,o,a=n.substring(1,n.length-1),u=!1;if(a.length>3&&"..."==a.substring(0,3)&&(u=!0),u){s="",a=a.substring(3),r=a.match(/[\w]+/g).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),o=e(r,i[1]);for(l in o)s+=l+'="'+o[l]+'" ';return""!==s?s:n}return r=a.match(/[\w]+/g).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),o=e(r,i[1]),"undefined"!=typeof o?o:n})}return arguments[0].replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof i[Number(n)+1]?i[Number(n)+1]:e})},extend:function(e,i){var n;for(n in i)e[n]=i[n];return e},deepObjCopy:function(e){var i={};if("object"==typeof e){if("undefined"!=typeof e.length)var i=new Array;for(var n in e){var t=typeof e[n];switch(t){case"object":i[n]=u.deepObjCopy(e[n]);break;case"boolean":1==e[n]?i[n]=!0:i[n]=!1;break;default:i[n]=e[n]}}}return i},debounce:function(e,i,n){var t,s,l,r,a,u=function(){var c=o()-r;i>c&&c>=0?t=setTimeout(u,i-c):(t=null,n||(a=e.apply(l,s),t||(l=s=null)))};return function(){l=this,s=arguments,r=o();var c=n&&!t;return t||(t=setTimeout(u,i)),c&&(a=e.apply(l,s),l=s=null),a}},createClass:function(e,i){var t={_init:function(e){this.props=e,"function"==typeof this.init&&this.init()}},s=i.mixins;if(s)for(var l in s)n(t,s[l]);n(t,i,"mixins"),t.classAlias=e;var r;return r=a.subClass(t),r.classAlias=e,r},render:function(e,i){if("object"!=typeof e)throw new Error("객체 타입["+typeof e+"]이 유효하지 않습니다.");if(null===i)throw new Error("랜더링 타겟 엘레멘트가 존재하지 않습니다.");var n=e.makeEl();e.willMount(),i.appendChild(n),setTimeout(function(){e.didMount()},0)}};return u});
