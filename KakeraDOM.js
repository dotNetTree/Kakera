/**
 * @license
 * Copyright (C) CABSOFTWARE.COM - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Seungchul Kang <ksc214@gmail.com>, November 2015
 * @version 1.1.1
 */
!function(e,i){"function"==typeof define&&define.amd?define([],i):e.KakeraDOM=i()}(this,function(){function e(i,t){var n=t[i[0]];return i.length>1&&"undefined"!=typeof n?e(i.slice(1,i.length),n):n}function t(e,i,t){var n;for(n in i)n==t&&"classAlias"==n||(e[n]=i[n]);return e}function n(e,i,t){document.addEventListener?e.addEventListener(i,t,!1):e.attachEvent?e.attachEvent("on"+i,t):e["on"+i]=t}function s(e,i,t){document.removeEventListener?e.removeEventListener(i,t,!1):e.attachEvent?e.detachEvent("on"+i,t):e["on"+i]=null}function r(e,i,t){var s,r,l,o,a,u,c=function(e,t){return function(n){i[e].call(t,n)}};for(r in i)if(u=r.split(" "),l=u.splice(0,1)[0],o=u.join(" "),"string"==typeof l&&"string"==typeof o)for(a=e.querySelectorAll(o),s=0;s<a.length;s++){var h=c(r,t);n(a.item(s),l,h)}}function l(){}var o=Date.now||function(){return(new Date).getTime()};!function(){var e=!1,i=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;l.subClass=function(t){function n(){!e&&this._init&&this._init.apply(this,arguments)}var s=this.prototype;e=!0;var r=new this;e=!1;for(var l in t)r[l]="function"==typeof t[l]&&"function"==typeof s[l]&&i.test(t[l])?function(e,i){return function(){var t=this._super;this._super=s[e];var n=i.apply(this,arguments);return this._super=t,n}}(l,t[l]):t[l];return n.prototype=r,n.constructor=n,n.subClass=this.subClass,t.classAlias&&(n.classAlias=t.classAlias),n}}();var a=l.subClass({_children:null,_debounceWait:100,deps:null,template:null,mixins:null,init:function(){},render:function(){if(null===this.template)throw new Error("["+this.classAlias+"] 클래스의 template이 null 입니다. template을 설정하거나 render를 구현하셔야 합니다.");return"string"==typeof this.template?this.template:this.template.length>1?this.template[0]:void 0},makeEl:function(){var i,s,l,o,c,h,f,d=document.createElement("div"),p={};f={"this":this};for(var v in a.prototype)delete f[v];if(i=this.render(),"object"==typeof i&&(t(f,i.param),i=i.template),i=i.replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">"),this.deps){var m,v,y,g,_=/[\w]+/g;for(o=0;o<this.deps.length;o++){s=this.deps[o],"undefined"==typeof p[s.classAlias]&&(p[s.classAlias]=[]);var w=i.match(new RegExp("<\\s*"+s.classAlias+"(?:\\/>|\\s+(?:.|\\s)*?\\/>)","g"));if(null!==w){var b=new RegExp("{\\.\\.\\..+?}|(\\w*=([\"|']*).+?\\2|{.+})(?=\\s|(?=>)|(?=\\/>))","g");for(c=0;c<w.length;c++){var A=w[c].match(b);if(p[s.classAlias][c]={},null!==A){for(h=0;h<A.length;h++){var z=A[h];if(0===z.indexOf("{...")){v=z.substring(4,z.length-1),y=v.match(_).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),g=e(y,f);for(var C in g)g[C]="function"==typeof g[C]?g[C].bind(this):g[C];t(p[s.classAlias][c],g)}else-1!=z.indexOf("=")&&(m=z.split("="),v=m[0],g=m[1],"{"==g.charAt(0)?(y=g.substring(1,g.length-1).match(_).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),g=e(y,f),g="function"==typeof g?g.bind(this):g,p[s.classAlias][c][v]=g):"'"==g.charAt(0)||'"'==g.charAt(0)?p[s.classAlias][c][v]=g.substring(1,g.length-1):p[s.classAlias][c][v]=g)}i=i.replace(w[c],"<div vdom='"+s.classAlias+"'></div>")}else i=i.replace(w[c],"<div vdom='"+s.classAlias+"'></div>")}}}}if(i=i.replace(/<[^\/].+?>/g,function(e){return e.replace(/={.+?}(?=(\s|>))/g,function(e){return"='"+e.substring(1,e.length)+"'"})}),d.innerHTML=u.format(i,f),1!=d.childNodes.length)throw new Error("["+this.classAlias+"] 클래스는 하나의 엘레멘트로 작성되어야 합니다.");return this.el=d.firstChild,r(d,this.listener,this),i=null,f=null,d=null,window&&"function"==typeof this.onWindowResize&&(this._onWindowResize=function(e){var i=function(i){e.onWindowResize.call(e,i)};return u.debounce(i,e._debounceWait)}(this),n(window,"resize",this._onWindowResize)),this.deps&&setTimeout(function(){for(this._children={},o=0;o<this.deps.length;o++){var e=this.deps[o],i=this.el.querySelectorAll("div[vdom='"+e.classAlias+"']");for(c=0;c<i.length;c++){l=u.useFreeze?Object.freeze(p[e.classAlias][c]):u.deepObjCopy(p[e.classAlias][c]);var t=new e(l);this.addChild(t);var n=t.makeEl();t.willMount(),i.item(c).parentNode.replaceChild(n,i.item(c));var s=function(e){return function(){e.didMount()}}(t);setTimeout(s,u.delay)}e=null}u.useFreeze||(p=null)}.bind(this),u.delay),this.el},willMount:function(){},didMount:function(){},refresh:function(){setTimeout(function(){var e,i=this.el;this.removeAllChild(),this._onWindowResize&&(s(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),e=this.makeEl(),this.willMount(),i.parentNode.replaceChild(e,i),setTimeout(function(){this.didMount()}.bind(this),u.delay)}.bind(this),u.delay)},children:function(e){var i;return null===this._children?null:(i="string"==typeof e?this._children.map[e]:"number"==typeof e?this._children.list[e]:this._children,"undefined"==typeof i?null:i)},addChild:function(e){this._children=this._children||{},this._children.list=this._children.list||[],this._children.list.push(e),this._children.map=this._children.map||{},"undefined"!=typeof this._children.map[e.classAlias]?this._children.map[e.classAlias].push(e):this._children.map[e.classAlias]=[e]},removeChild:function(e){var t,n,s,r;if(null!==this._children){if("number"==typeof e)t=e,s=this._children.list[t];else for(t=0;t<this._children.list.length;t++)if(this._children.list[t]===e){s=this._children.list[t];break}if(s){for(r=this._children.map[s.classAlias],this._children.list.splice(t,1),n=0;i<r.length;n++)r[n]===s&&r.splice(n,1);s.release()}0===this._children.list.length&&(this._children=null)}},removeAllChild:function(){var e,i;if(null!==this._children){if("undefined"!=typeof this._children.list){e=this._children.list.length;for(var t=0;e>t;t++)i=this._children.list[t],i.release()}this._children=null}},release:function(){var e;if(null!==this._children){if(e=this._children.list,null!==e&&"undefined"!=typeof e)for(var i=0;i<e.length;i++)e[i].release();this._children=null}this._onWindowResize&&(s(window,"resize",this._onWindowResize),this._onWindowResize=null,delete this._onWindowResize),"function"==typeof this.destroy&&this.destroy(),this.el.parentNode.removeChild(this.el)},destroy:function(){}}),u={delay:0,useFreeze:"function"==typeof Object.freeze,multiline:function(e){return e.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"").replace(/\s+</g,"<").replace(/>\s+/g,">")},format:function(){var i=arguments;if(2==arguments.length){if(arguments[1]instanceof Array)return arguments[0].replace(/{(\d+)}/g,function(e,t){return"undefined"!=typeof i[1][t]?i[1][t]:e});if(arguments[1]instanceof Object)return arguments[0].replace(/{[^}]+}/g,function(t,n){var s,r,l,o,a=t.substring(1,t.length-1),u=!1;if(a.length>3&&"..."==a.substring(0,3)&&(u=!0),u){s="",a=a.substring(3),l=a.match(/[\w]+/g).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),o=e(l,i[1]);for(r in o)s+=r+'="'+o[r]+'" ';return""!==s?s:t}return l=a.match(/[\w]+/g).map(function(e){var i=parseInt(e);return isNaN(i)?e:i}),o=e(l,i[1]),"undefined"!=typeof o?o:t})}return arguments[0].replace(/{(\d+)}/g,function(e,t){return"undefined"!=typeof i[Number(t)+1]?i[Number(t)+1]:e})},extend:function(e,i){var t;for(t in i)e[t]=i[t];return e},deepObjCopy:function(e){var i={};if("object"==typeof e){if("undefined"!=typeof e.length)var i=new Array;for(var t in e){var n=typeof e[t];switch(n){case"object":i[t]=u.deepObjCopy(e[t]);break;case"boolean":1==e[t]?i[t]=!0:i[t]=!1;break;default:i[t]=e[t]}}}return i},debounce:function(e,i,t){var n,s,r,l,a,u=function(){var c=o()-l;i>c&&c>=0?n=setTimeout(u,i-c):(n=null,t||(a=e.apply(r,s),n||(r=s=null)))};return function(){r=this,s=arguments,l=o();var c=t&&!n;return n||(n=setTimeout(u,i)),c&&(a=e.apply(r,s),r=s=null),a}},createClass:function(e,i){var n={_init:function(e){this.props=e,"function"==typeof this.init&&this.init()}},s=i.mixins;if(s)for(var r in s)t(n,s[r]);t(n,i,"mixins"),n.classAlias=e;var l;return l=a.subClass(n),l.classAlias=e,l},render:function(e,i){if("object"!=typeof e)throw new Error("객체 타입["+typeof e+"]이 유효하지 않습니다.");if(null===i)throw new Error("랜더링 타겟 엘레멘트가 존재하지 않습니다.");var t=e.makeEl();e.willMount(),i.appendChild(t),setTimeout(function(){e.didMount()},0)}};return u});